---
# Updated for Apple Silicon Macs - January 2025
# Uses pyenv for Python version management (more reliable than get-pip.py approach)

# =============================================================================
# PYTHON VERSION MANAGEMENT
# =============================================================================
- name: Install pyenv and dependencies
  community.general.homebrew:
    name:
      - pyenv                  # Python version manager
      - openssl                # Required for building Python
      - readline               # Required for building Python
      - sqlite3                # Required for building Python
      - xz                     # Required for building Python
      # Note: zlib is installed in common role (image libraries)
    state: present
  when: ansible_facts['os_family'] == 'Darwin'
  tags: python

# =============================================================================
# PYTHON PACKAGE MANAGERS
# =============================================================================
- name: Install Python package managers
  community.general.homebrew:
    name:
      - poetry                   # Dependency management & packaging
      - uv                       # Fast Python package installer & resolver
    state: present
  when: ansible_facts['os_family'] == 'Darwin'
  tags: python

# =============================================================================
# PIP CONFIGURATION
# Uses modern XDG-compliant path (~/.config/pip/)
# =============================================================================
- name: Add pip config directory
  file:
    path: ~/.config/pip
    state: directory
    mode: '0755'
  tags: python

- name: Setup pip configuration
  copy:
    dest: ~/.config/pip/pip.conf
    src: pip.conf
  tags: python

# =============================================================================
# PYENV SHELL INTEGRATION
# Note: pyenv initialization is handled in zshrc
# =============================================================================
