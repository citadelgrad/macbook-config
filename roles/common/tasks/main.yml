---
# Updated for Apple Silicon Macs - February 2026

# =============================================================================
# UUTILS COREUTILS (Rust-based GNU coreutils)
# Provides more efficient tail/head using modern system APIs (inotify/kqueue)
# =============================================================================
- name: Unlink conflicting GNU coreutils
  command: brew unlink coreutils
  register: unlink_result
  changed_when: "'Unlinking' in unlink_result.stdout"
  failed_when: false
  when: ansible_facts['os_family'] == 'Darwin'
  tags: cli-tools

- name: Install uutils-coreutils
  community.general.homebrew:
    name:
      - uutils-coreutils        # Rust rewrite of GNU coreutils
    state: present
  when: ansible_facts['os_family'] == 'Darwin'
  tags: cli-tools

# =============================================================================
# BROWSERS
# =============================================================================
- name: Install browsers
  community.general.homebrew_cask:
    name:
      - firefox
      - brave-browser
      - microsoft-edge
    state: present
    install_options: adopt
  when: ansible_facts['os_family'] == 'Darwin'
  tags: browsers

# =============================================================================
# PRODUCTIVITY & UTILITIES
# =============================================================================
- name: Install productivity apps
  community.general.homebrew_cask:
    name:
      - slack
      - itsycal                # Menu bar calendar
      - maccy                  # Clipboard manager
      - espanso                # Text expansion
      - karabiner-elements     # Keyboard customization
      - keepassxc              # Password manager
      - zoom                   # Video conferencing
    state: present
    install_options: adopt
  when: ansible_facts['os_family'] == 'Darwin'
  tags: productivity

# =============================================================================
# MEDIA & AUDIO
# =============================================================================
- name: Install media apps
  community.general.homebrew_cask:
    name:
      - soundsource            # Audio control per-app
      - vlc                    # Video player
    state: present
    install_options: adopt
  when: ansible_facts['os_family'] == 'Darwin'
  tags: media

# =============================================================================
# DEVELOPER TOOLS - GUI APPLICATIONS
# =============================================================================
- name: Install developer GUI apps
  community.general.homebrew_cask:
    name:
      - iterm2                 # Terminal emulator
      - visual-studio-code     # Code editor
      - zed                    # Fast code editor
      - postman                # API development
      - github                 # GitHub Desktop
      - orbstack               # Fast, lightweight Docker & Linux VM
      - claude-code            # Claude Code desktop
      - ngrok                  # Secure tunnels
    state: present
    install_options: adopt
  when: ansible_facts['os_family'] == 'Darwin'
  tags: developer

# =============================================================================
# MOBILE DEVELOPMENT
# =============================================================================
- name: Install mobile development tools
  community.general.homebrew_cask:
    name:
      - android-commandlinetools  # Android SDK CLI tools
      - android-studio            # Android IDE
    state: present
    install_options: adopt
  when: ansible_facts['os_family'] == 'Darwin'
  tags: mobile-dev

# =============================================================================
# CLOUD TOOLS (CASKS)
# =============================================================================
- name: Install cloud tool casks
  community.general.homebrew_cask:
    name:
      - gcloud-cli             # Google Cloud SDK
    state: present
    install_options: adopt
  when: ansible_facts['os_family'] == 'Darwin'
  tags: cloud

# =============================================================================
# FONTS
# =============================================================================
- name: Install fonts
  community.general.homebrew_cask:
    name:
      - font-symbols-only-nerd-font
    state: present
    install_options: adopt
  when: ansible_facts['os_family'] == 'Darwin'
  tags: fonts

# =============================================================================
# JAVA
# =============================================================================
- name: Install Java runtime
  community.general.homebrew_cask:
    name:
      - temurin                # Eclipse Temurin JDK
    state: present
    install_options: adopt
  when: ansible_facts['os_family'] == 'Darwin'
  tags: java

# =============================================================================
# DEVELOPER TOOLS - CLI (Modern replacements)
# =============================================================================
- name: Install modern CLI tools
  community.general.homebrew:
    name:
      # Modern CLI replacements
      - bat                    # Better cat with syntax highlighting
      - eza                    # Modern ls replacement (was exa)
      - lsd                    # Modern ls with git status & icons
      - fd                     # Better find
      - ripgrep                # Better grep (rg)
      - fzf                    # Fuzzy finder
      - dust                   # Intuitive disk usage (du replacement)
      - jq                     # JSON processor
      # Shell & prompt
      - fish                   # Friendly interactive shell
      - starship               # Cross-shell prompt
      # Git tools
      - git                    # Version control
      - git-secrets            # Prevent secrets in commits
      - git-lfs                # Large file storage
      - git-filter-repo        # Fast git history rewriting
      - gitleaks               # Secret scanning for git repos
      - gh                     # GitHub CLI
      # Terminal tools
      - tmux                   # Terminal multiplexer
      - direnv                 # Directory-specific env vars
      - tree                   # Directory visualization
      - mole                   # SSH tunnel manager
      # Dev tools
      - mkcert                 # Local HTTPS certificates
      - watchman               # File watching service
      - gum                    # Glamorous shell scripts
      - pv                     # Pipe viewer (progress for pipes)
      - rename                 # Batch file rename
      - wget                   # HTTP file retrieval
      # Encryption
      - age                    # Modern file encryption (used by chezmoi)
    state: present
  when: ansible_facts['os_family'] == 'Darwin'
  tags: cli-tools

# =============================================================================
# CLOUD & DEVOPS
# =============================================================================
- name: Install cloud and DevOps tools
  community.general.homebrew:
    name:
      - awscli                 # AWS CLI v2
      - terraform              # Infrastructure as code
      - helm                   # Kubernetes package manager
      - stripe-cli             # Stripe API CLI
      - supabase               # Supabase CLI
    state: present
  when: ansible_facts['os_family'] == 'Darwin'
  tags: cloud

# =============================================================================
# WEB DEVELOPMENT
# =============================================================================
- name: Install web development tools
  community.general.homebrew:
    name:
      - httpie                 # User-friendly HTTP client
      - yarn                   # JavaScript package manager
      # Note: bun is installed via its own installer (~/.bun/), not Homebrew
      - node@22                # Node.js LTS
      - node@24                # Node.js current
    state: present
  when: ansible_facts['os_family'] == 'Darwin'
  tags: webdev

# =============================================================================
# CONTAINERS
# =============================================================================
- name: Install container tools
  community.general.homebrew:
    name:
      - docker-compose         # Multi-container Docker applications
    state: present
  when: ansible_facts['os_family'] == 'Darwin'
  tags: containers

# =============================================================================
# DATABASES
# =============================================================================
- name: Install database tools
  community.general.homebrew:
    name:
      - postgresql@15          # PostgreSQL database
      - redis                  # In-memory data store
    state: present
  when: ansible_facts['os_family'] == 'Darwin'
  tags: databases

# =============================================================================
# AI/LLM TOOLS
# =============================================================================
- name: Install AI and LLM tools
  community.general.homebrew:
    name:
      - ollama                 # Local LLM runner
      - fabric-ai             # AI augmented CLI
      - gemini-cli             # Google Gemini CLI
    state: present
  when: ansible_facts['os_family'] == 'Darwin'
  tags: ai

# =============================================================================
# MEDIA TOOLS (CLI)
# =============================================================================
- name: Install media CLI tools
  community.general.homebrew:
    name:
      - ffmpeg                 # Video/audio processing
      - yt-dlp                 # Video downloader
    state: present
  when: ansible_facts['os_family'] == 'Darwin'
  tags: media

# =============================================================================
# LANGUAGES
# =============================================================================
- name: Install programming languages
  community.general.homebrew:
    name:
      - rust                   # Rust programming language
    state: present
  when: ansible_facts['os_family'] == 'Darwin'
  tags: languages

# =============================================================================
# IMAGE LIBRARIES (for Python/PIL support)
# =============================================================================
- name: Install image libraries
  community.general.homebrew:
    name:
      - zlib
      - libtiff
      - libjpeg
      - webp
      - little-cms2
    state: present
  when: ansible_facts['os_family'] == 'Darwin'
  tags: libraries
