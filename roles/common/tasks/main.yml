---
# Updated for Apple Silicon Macs - January 2025

# =============================================================================
# UUTILS COREUTILS (Rust-based GNU coreutils)
# Provides more efficient tail/head using modern system APIs (inotify/kqueue)
# =============================================================================
- name: Unlink conflicting GNU coreutils
  command: brew unlink coreutils
  register: unlink_result
  changed_when: "'Unlinking' in unlink_result.stdout"
  failed_when: false
  when: ansible_facts['os_family'] == 'Darwin'
  tags: cli-tools

- name: Install uutils-coreutils
  community.general.homebrew:
    name:
      - uutils-coreutils        # Rust rewrite of GNU coreutils
    state: present
  when: ansible_facts['os_family'] == 'Darwin'
  tags: cli-tools

# =============================================================================
# BROWSERS
# =============================================================================
- name: Install browsers
  community.general.homebrew_cask:
    name:
      - firefox
      - brave-browser
    state: present
  when: ansible_facts['os_family'] == 'Darwin'
  tags: browsers

# =============================================================================
# PRODUCTIVITY & UTILITIES
# =============================================================================
- name: Install productivity apps
  community.general.homebrew_cask:
    name:
      - slack
      - libreoffice
      - rectangle              # Window management (replaces discontinued shiftit)
      - raycast                # Spotlight replacement with extensions
      - itsycal                # Menu bar calendar
      - maccy                  # Clipboard manager
      - alt-tab                # Windows-style alt-tab
      - stats                  # System monitor in menu bar
      - the-unarchiver         # Archive extraction
      - appcleaner             # Clean app uninstalls
    state: present
  when: ansible_facts['os_family'] == 'Darwin'
  tags: productivity

# =============================================================================
# MEDIA & AUDIO
# =============================================================================
- name: Install media apps
  community.general.homebrew_cask:
    name:
      - soundsource            # Audio control per-app
      - vlc                    # Video player
    state: present
  when: ansible_facts['os_family'] == 'Darwin'
  tags: media

# =============================================================================
# DEVELOPER TOOLS - GUI APPLICATIONS
# =============================================================================
- name: Install developer GUI apps
  community.general.homebrew_cask:
    name:
      - iterm2                 # Terminal emulator
      - visual-studio-code     # Code editor
      - cursor                 # AI-enhanced code editor
      - postman                # API development
      - github                 # GitHub Desktop
      - orbstack               # Fast, lightweight Docker & Linux VM
    state: present
  when: ansible_facts['os_family'] == 'Darwin'
  tags: developer

# =============================================================================
# DEVELOPER TOOLS - CLI (Modern replacements)
# =============================================================================
- name: Install modern CLI tools
  community.general.homebrew:
    name:
      # Modern CLI replacements
      - bat                    # Better cat with syntax highlighting
      - eza                    # Modern ls replacement (was exa)
      - lsd                    # Modern ls with git status & icons
      - fd                     # Better find
      - ripgrep                # Better grep (rg)
      - fzf                    # Fuzzy finder
      - zoxide                 # Smarter cd command
      - tldr                   # Simplified man pages
      - jq                     # JSON processor
      - yq                     # YAML processor
      # Git tools
      - git                    # Version control
      - git-secrets            # Prevent secrets in commits
      - git-lfs                # Large file storage
      - git-delta              # Better git diff
      - gh                     # GitHub CLI
      # Terminal tools
      - tmux                   # Terminal multiplexer
      - direnv                 # Directory-specific env vars
      - tree                   # Directory visualization
      - mole                   # SSH tunnel manager
    state: present
  when: ansible_facts['os_family'] == 'Darwin'
  tags: cli-tools

# =============================================================================
# CLOUD & DEVOPS
# =============================================================================
- name: Install cloud and DevOps tools
  community.general.homebrew:
    name:
      - awscli                 # AWS CLI v2
      - aws-cdk                # AWS Cloud Development Kit
      - terraform              # Infrastructure as code
      - kubectl                # Kubernetes CLI
      - helm                   # Kubernetes package manager
    state: present
  when: ansible_facts['os_family'] == 'Darwin'
  tags: cloud

# =============================================================================
# WEB DEVELOPMENT
# =============================================================================
- name: Install web development tools
  community.general.homebrew:
    name:
      - httpie                 # User-friendly HTTP client
      - yarn                   # JavaScript package manager
      - bun                    # Fast JavaScript runtime & package manager
    state: present
  when: ansible_facts['os_family'] == 'Darwin'
  tags: webdev

# =============================================================================
# IMAGE LIBRARIES (for Python/PIL support)
# =============================================================================
- name: Install image libraries
  community.general.homebrew:
    name:
      - zlib
      - libtiff
      - libjpeg
      - webp
      - little-cms2
    state: present
  when: ansible_facts['os_family'] == 'Darwin'
  tags: libraries
