---
# Updated for Apple Silicon Macs - January 2025
# Note: macOS ships with zsh as the default shell since Catalina (10.15)

# =============================================================================
# OH-MY-ZSH INSTALLATION
# =============================================================================
- name: Check if oh-my-zsh is installed
  stat:
    path: ~/.oh-my-zsh
  register: ohmyzsh_installed
  tags: zsh

- name: Install oh-my-zsh
  git:
    repo: https://github.com/ohmyzsh/ohmyzsh.git
    dest: ~/.oh-my-zsh
    depth: 1
  when: not ohmyzsh_installed.stat.exists
  tags: zsh

# =============================================================================
# ZSH CONFIGURATION
# =============================================================================
- name: Add zshrc file
  copy:
    src: zshrc
    dest: ~/.zshrc
    backup: yes
  tags: zsh

# =============================================================================
# OPTIONAL: POWERLEVEL10K THEME
# Uncomment if you want a more powerful prompt
# =============================================================================
# - name: Install powerlevel10k theme
#   git:
#     repo: https://github.com/romkatv/powerlevel10k.git
#     dest: ~/.oh-my-zsh/custom/themes/powerlevel10k
#     depth: 1
#   tags: zsh

# =============================================================================
# ZSH PLUGINS (via Homebrew for better updates)
# =============================================================================
- name: Install zsh plugins via brew
  community.general.homebrew:
    name:
      - zsh-autosuggestions
      - zsh-syntax-highlighting
    state: present
  when: ansible_os_family == 'Darwin'
  tags: zsh
